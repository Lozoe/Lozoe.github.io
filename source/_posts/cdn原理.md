---
title: cdn原理
date: 2024-01-29 19:16:56
categories: [Network]
tags:
---
CDN（Content Delivery Network, 内容分发网络）是为加快网络访问速度而建立在现有网络之上的分布式网络，它依靠部署在全球各地边缘节点的服务器群，通过负载均衡，内容发布，内容管理和内容存储的功能，由CDN服务器集群分担源站点服务器集群的压力，使用户可以就近获取已缓存的访问资源，避免网络拥堵，加快访问速度。与此同时，CDN是基于DNS解析进行管理的，其利用DNS技术和HTTPS协议确保了传输内容的安全性，保障用户的访问内容的安全性。
<!-- more -->
## CDN的访问过程/加速原理

CDN的基本原理是依靠部署在各个区域大量缓存服务器的响应。当用户访问网站时，不需要访问站点的DNS服务器，而是利用全局负载技术将用户的请求直接指向最近的缓存服务器上，且保证服务器是正常工作的，访问的路径和内容是传输安全的，由此缓存服务器直接响应客户的请求。访问缓存服务器可以尽可能地避免网络拥堵状况，使传输的内容更加迅速和稳定。

CDN的访问过程依赖于DNS的重定向技术，即将用户定向至地理位置上距离其最近的边缘CDN节点服务器上。
用户首先向根DNS服务器发送域名解析请求，根DNS服务器向授权DNS服务器发送域名解析请求，请求中包含了根服务器的IP地址，当域名解析服务器/根DNS服务器接受到一个CNAME类的DNS记录，域名解析服务器会重定向到CDN节点网络层中的智能CDN域名服务器上，CDN域名服务器将进行一系列的智能解析操作，根据本地DNS域名解析服务器的IP地址，分析各个网络线路的拥堵情况和负载情况，将最适合的CDN节点服务器IP地址返还给根DNS服务器，用户接受到CDN节点的IP地址后，直接向CDN节点服务器发送请求获取网站内容(图1， CDN的加速原理）。

<img src="cdn.png" alt="cdn" width="500" align="bottom" />

注：

步骤2与步骤3，若本地DNS中的数据缓存过期或已经失效，本地服务器向根服务器发出请求，根服务器返回可查询的授权DNS服务器地址；若本地DNS服务器缓存中可直接查询到IP地址，无需像根服务器发出请求。

步骤10与步骤11，如果CDN节点并没有用户所需的缓存资源或是资源已经失效，节点将向源服务机集群发出请求，CDN节点将结合用户定制的缓存策略将源服务器集群返回的资源缓存至CDN节点，再返回内容给用户；若访问的CDN节点可调取缓存资源，将直接返回用户访问内容。

## CDN的系统构成

CDN的系统构成具体如下表：

| 名称 | 内容 |
| --- | --- |
| 智能调度系统 |策略中心 http dns 302调度 智能dns解析 |
| 缓存系统 | 高速缓存服务器组 负载均衡设备 |
|  链路监测系统 | 智能DNS 检测系统 链路选择系统 |
|  其他服务系统 | 资源监控 配置分析 配置管理 |

## cdn核心技术

一、内容路由（负载均衡技术）
每个CDN节点层都配备智能DNS服务器，即负载均衡设备，其作用是使Cache协同工作，它根据用户源IP地址解析导向整个CDN节点层中的最佳节点。
最佳节点的选择是根据CDN管理系统决定的，而负载均衡系统是整个CDN的核心，一般来说负载均衡分为两个层次，第一层是全局负载均衡负责给用户定向至最近的CDN节点或区域，第二层是本地负载均衡，CDN节点层中的智能CDN服务器会负责对本地系统及子系统进行实时监测，并将各节点流量保存至数据库，对系统中监测到系统状况产生故障告警，给用户定向至最优（离客户访问距离近，内容传输速度快，访问时间短，内容稳定性高）的CDN节点。

二、内容存储
内容存储是CDN的另一个关键技术，内容存储决定了用户访问网站内容的速度和质量。考虑两个方面，站点源服务器的存储功能和Cache节点中的存储功能。
多运用海量存储架构实现大数据存储。对于Cache节点的存储需支持各种文件格式的存储和读取，并且具备高文件吞吐率，强可靠性和高稳定性的特征。

三、内容发布
内容发布是借助索引，缓存，流分裂，组播等技术，将内容由内容源分发到CDN边缘的整个缓存过程，内容分发技术主要是PUSH(主动分发技术）和PULL(被动分发技术）。PUSH一般是由供应商或是CDN的内容管理人员从站点源服务器或媒体的资源库直接向各个CDN节点主动分发的一些热点内容，或是客户指定的内容。PULL则是客户向节点请求缓存中没有存储的内容时，Cache从源服务器或是其他CDN节点请求获取内容。

四、内容管理
内容管理即CDN本地内容管理，主要针对CDN节点层进行
内容管理利用内容感知度的调度，一定程度上提高了负载均衡的效率，提高了内容服务的效率和本地节点存储空间的利用率。

https://www.sohu.com/a/604080831_120642736